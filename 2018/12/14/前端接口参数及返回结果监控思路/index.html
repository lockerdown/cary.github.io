<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Cary Yang,carynihility@gmail.com"><title>客户端通过传参返回服务端接口数据思路讲解 · 黑胖子的博客</title><meta name="description" content="先简单梳理一下web站 api站工作原理12345678910111213st=&amp;gt;start: url输入e=&amp;gt;end: 页面输出st-&amp;gt;op1-&amp;gt;op2op1=&amp;gt;operation: 匹配路由op2=&amp;gt;operation: 经过中间件op3=&amp;gt;operat"><meta name="keywords" content="Angular, Babel, CLI, CSS-in-JS, Gatsby, GraphQL, JavaScript, React, TypeScript, WebAssembly, github, npm, vue, webpack, 服务端渲染, JavaScript, 前端工具资源"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta content="codeva-omByo1T2Oa" name="baidu-site-verification"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><!-- Global site tag (gtag.js) - Google Analytics --><script src="https://www.googletagmanager.com/gtag/js?id=G-8T3DP764SR"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-8T3DP764SR');</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">黑胖子的博客</a></h3><div class="description"><p>The sun is the nihility in your delusion eyes.</p></div></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/yangyichen"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="http://instagram.com/nihility__"><i class="fa fa-instagram"></i></a></li><li><a href="/atom.xml"><i class="fa fa-rss"></i></a></li></ul><div class="footer"><a target="_blank" href="javascript:;"><span>Theme by</span></a><a target="_blank" rel="noopener" href="https://www.caicai.me"> CaiCai</a><span>&</span><a target="_blank" rel="noopener" href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于</a></li><!--li--><!--  if is_current('weekly')--><!--    a.current(href="/tags/weekly")= __('Weekly')--><!--  else--><!--    a(href="/tags/weekly")= __('Weekly')--></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"></a></li></div><div class="avatar"><img src="/images/avatar.jpg"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>客户端通过传参返回服务端接口数据思路讲解</a></h3></div><div class="post-content"><h3 id="先简单梳理一下web站-api站工作原理"><a href="#先简单梳理一下web站-api站工作原理" class="headerlink" title="先简单梳理一下web站 api站工作原理"></a>先简单梳理一下web站 api站工作原理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: url输入</span><br><span class="line">e=&gt;end: 页面输出</span><br><span class="line">st-&gt;op1-&gt;op2</span><br><span class="line"></span><br><span class="line">op1=&gt;operation: 匹配路由</span><br><span class="line">op2=&gt;operation: 经过中间件</span><br><span class="line">op3=&gt;operation: 经过过滤器</span><br><span class="line">op5=&gt;operation: 发送到api站</span><br><span class="line">op6=&gt;operation: 结果返回</span><br><span class="line">op4=&gt;operation: 渲染页面</span><br><span class="line"></span><br><span class="line">st-&gt;op1-&gt;op2-&gt;op3-&gt;op4</span><br><span class="line">op5-&gt;op6-&gt;e</span><br></pre></td></tr></table></figure>
<h3 id="目前的方案"><a href="#目前的方案" class="headerlink" title="目前的方案"></a>目前的方案</h3><ol>
<li>初始化web站的时候,增加中间件,req.query.nowucme<code>(now you see me的缩写)</code>判断是否为预览接口模式,如果是true的话则开启</li>
<li>增加一个SORID<code>(same-origin requese ID)</code>,SORID为一个UUID<code>(全球唯一ID)</code>,传到API站点作为识别代码</li>
<li>OOZ站点接收所有请求并保存在mongoDB</li>
<li>在渲染页面时注入一段js,开启websocket发送当前用户的GUID以及SORID</li>
<li>OOZ站点新建一条路由接收ws发送的参数并查库,过滤后返回</li>
<li>页面接收到参数并显示在页面上</li>
<li>对数据精简,适当进行json格式化以及美化样式</li>
</ol>
<h3 id="涉及到的技术点"><a href="#涉及到的技术点" class="headerlink" title="涉及到的技术点"></a>涉及到的技术点</h3><ul>
<li>mongoDB基本增删改查语句</li>
<li>mongoDB的读写,schema和model的运用与理解</li>
<li>服务端以及客户端websocket的建立以及传输</li>
</ul>
<h3 id="可以优化的点或者问题"><a href="#可以优化的点或者问题" class="headerlink" title="可以优化的点或者问题"></a>可以优化的点或者问题</h3><ol>
<li>因为页面发送的请求是异步的,不可控制的,所以现在在OOZ站点进行的是定时器查询,是否可以等到最后一次请求结束后,只查询一次数据库?</li>
<li>因为请求是以一个独立链接匹配路由的,所以SORID并不能由Referer继承,所以目前在express中是一个全局变量.<ol>
<li>一次页面访问会生成一个新的SORID,覆盖上次的.</li>
<li>未加nowucme参数时访问的页面会带着上次的SORID,如果查询历史访问数据可能会出现很多</li>
</ol>
</li>
<li>有些下单页面无法加入参数,有些页面获取不到请求</li>
</ol>
<h3 id="开会讨论后的结果"><a href="#开会讨论后的结果" class="headerlink" title="开会讨论后的结果"></a>开会讨论后的结果</h3><ol>
<li>把SORID放在中间件里,直接渲染在同步页面</li>
<li>修改djutils.ajax,增加SORID参数</li>
<li>页面onLoad之后请求OOZ拿到数据并渲染</li>
</ol>
<h3 id="误区"><a href="#误区" class="headerlink" title="误区"></a>误区</h3><ul>
<li>只需要上次页面的结果而不是需要当前页面的结果 而我关注的点是只关心当前页面数据,不去考虑历史</li>
<li>参数+SORID直接查询结果</li>
<li>通过head参数判断请求来自api还是web,如果是web则重新生成SORID</li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-12-14</span><i class="fa fa-comment-o"></i><a href="/2018/12/14/%E5%89%8D%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E5%8F%8A%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E7%9B%91%E6%8E%A7%E6%80%9D%E8%B7%AF/#comments">评论</a><i class="fa fa-tag"></i><a href="/tags/页面/" title="页面" class="tag">页面 </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2019/01/01/2018%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" title="2018年度总结" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2018/12/10/webpack%20loader%E8%AF%A6%E8%A7%A3/" title="webpack loader详解" class="btn">下一篇</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'heipangzi';
var disqus_identifier = '2018/12/14/前端接口参数及返回结果监控思路/';
var disqus_title = '客户端通过传参返回服务端接口数据思路讲解';
var disqus_url = 'https://cary.im/2018/12/14/前端接口参数及返回结果监控思路/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//heipangzi.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>