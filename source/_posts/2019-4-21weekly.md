---
title: 周报
date: 2019-4-21 22:17:44
tags: weekly
---

### 本周主要任务

详情页领取红包

### 本周总结

### **PC呈现逻辑**
* 若该线路未配置红包，则去领红包入口隐藏，若配置了红包，则呈现红包领取入口；
* 红包按照金额从高到低进行排序；
* 有效期过期红包，弹框内不再呈现
* 若红包较多则需进行滑动查看；
* 新增弹框,弹框有一键领取功能

### H5呈现逻辑
* 优化优惠的展示方式，展示线路中所有可用的积分、立减、点评返现 一行呈现
* 红包单独显示
* 当产品线路支持红包属性时,显示有领券入口
* 详情页领取入口，点击领券，需要用户登录（小程序忽略，H5跳转登陆页）
* 如果优惠部分只有优惠立减，则显示 标签+短说明的形式
* 线路详情页删除原先的支持红包标识
* 新增红包列表页面


### 红包逻辑
* 领取
  * 不可重复领取
  * 通过**IsGet**判断是否未领取
  * 已领取之后，不会显示已抢光状态
* 已领取
  * 若用户领取后未使用已过期，但详情页依旧呈现红包则显示已领取状态；
* 已抢光
  * 判断如果未领取，并且红包优惠规则结束时间和当前时间相差32天内


### 判断项
#### 是否登录的判断
用**djutils.memberid**判断是否登录

#### 详情页是否开放红包领取
RedOpenGet （0-不开放 1-开放）
#### 是否领取
IsGet 是否领取（1-未领取 2-已领取 3-已抢光）

### 遇到的问题点
* 有红包和没有红包的样式兼容
* 跳转登陆用了djutils中的**mLogin**方法
* 一键领取时当其中有失败时提示
* 小程序弹框统一,包括高度和按钮样式
* lineId在隐藏域中名字不同
* 周边跟团产品详情页没有IsRedPrivilege字段


### 公共文件封装
allinpc封装了pc的3站领取红包样式以及js,弹框并不是每个项目都有,所以手动在dj和gt项目的detail.ejs中增加了关于modal的html以及less.统一了PC的样式
路由方面,使用了ajax发送.根据ajax中url的相对路径规则,url地址统一为**detail/membergetred**,并分别在各自router文件中创建依据当前项目为前缀的路由地址.
PC中所有的红包都是同步
H5中所有红包都是异步

### 接口文档
[领取红包接口](http://dsf.17usoft.com/wiki/service/dsf.gl.core.campaign.api/16.1.0.0/component/membergetred/detail)
[优惠接口](http://dsf.t.17usoft.com/wiki/service/dsf.dj.marketing/8.0.0.0/preferentialquery/getproductpreferential/detail)

### TODO
H5样式统一,包括弹框,红包,优惠等


### 下周任务

详情页领取红包收尾